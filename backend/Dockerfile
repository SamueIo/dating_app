# V칳chodiskov칳 obraz pre PHP 8.2 s CLI
FROM php:8.2-cli

# In코tal치cia potrebn칳ch bal칤캜kov pre obr치zky a GD kni쬹icu s podporou pre WebP
RUN apt-get update && apt-get install -y \
    git \
    curl \
    zip \
    unzip \
    libpng-dev \
    libjpeg-dev \
    libfreetype6-dev \
    libonig-dev \
    libxml2-dev \
    libzip-dev \
    procps \
    libwebp-dev \
    && docker-php-ext-configure gd --with-freetype --with-jpeg --with-webp \
    && docker-php-ext-install pdo pdo_mysql mbstring zip exif pcntl gd \
    && apt-get clean

# 游댢 Nastavenie PHP upload limitov
RUN echo "upload_max_filesize=10M" > /usr/local/etc/php/conf.d/uploads.ini \
    && echo "post_max_size=60M" >> /usr/local/etc/php/conf.d/uploads.ini \
    && echo "max_file_uploads=20" >> /usr/local/etc/php/conf.d/uploads.ini \
    && echo "max_execution_time=300" >> /usr/local/etc/php/conf.d/uploads.ini \
    && echo "max_input_time=300" >> /usr/local/etc/php/conf.d/uploads.ini

# Nastavenie pracovn칠ho adres치ra v kontejnery
WORKDIR /app

# Kop칤rovanie aplik치cie do kontajnera
COPY . .

# In코tal치cia Composeru z ofici치lneho obrazu
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer
RUN composer install --no-dev --optimize-autoloader

# Kop칤rovanie a nastavenie pr치v pre docker-entrypoint skript
COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Exponovanie portu 3000 pre pr칤stup k aplik치cii
EXPOSE 3000

# Spustenie docker-entrypoint skriptu
ENTRYPOINT ["docker-entrypoint.sh"]
